<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UMKM Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <style>
    body {
      display: flex;
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: #f4f6f8;
    }

    .sidebar {
      width: 220px;
      background: #2C3E50;
      color: white;
      height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }

    .sidebar h2 {
      text-align: center;
      margin-bottom: 30px;
    }

    .sidebar a {
      display: block;
      color: #ecf0f1;
      text-decoration: none;
      padding: 10px 15px;
      border-radius: 8px;
      transition: 0.3s;
      margin-bottom: 10px;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background: #3498db;
      color: #fff;
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #2C3E50;
      font-size: 24px;
    }

    .buttons button {
      margin-left: 10px;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      background: #3498db;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }

    .buttons button:hover {
      background: #2980b9;
    }

    /* Grid layout for UMKM cards */
    .umkm-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 10px;
    }

    .umkm-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      transition: 0.3s;
      position: relative;
    }

    .umkm-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    .umkm-card h3 {
      margin-top: 0;
      color: #34495e;
      font-size: 20px;
    }

    .umkm-card p {
      margin: 6px 0;
      font-size: 14px;
      color: #555;
    }

    .umkm-card .revenue {
      color: #27ae60;
      font-weight: bold;
      font-size: 16px;
    }

    .loading {
      text-align: center;
      margin-top: 40px;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>UMKM Connect</h2>
    <a href="dashboard.html">Dashboard</a>
    <a href="#">User Profile</a>
    <a href="#" class="active">UMKM List</a>
  </div>

  <div class="main-content">
    <div class="header">
      <h1>UMKM Directory</h1>
      <div class="buttons">
        <button id="adminBtn" style="display:none;">Admin Panel</button>
        <button id="umkmBtn" style="display:none;">Add UMKM</button>
        <button id="investorBtn" style="display:none;">Investor Panel</button>
        <button id="logoutBtn">Logout</button>
      </div>
    </div>

    <p id="welcome" style="padding: 0 25px;"></p>

    <div id="umkmContainer" class="umkm-grid">
      <p class="loading">Loading UMKM data...</p>
    </div>
  </div>

  <script>
    window.onload = async () => {
      const role = localStorage.getItem("role");
      const username = localStorage.getItem("username");

      if (!role) {
        alert("Please log in first!");
        window.location.href = "/login.html";
        return;
      }

      document.getElementById("welcome").textContent = 
        `Welcome, ${username}! You are logged in as ${role}.`;

      if (role === "admin") document.getElementById("adminBtn").style.display = "inline-block";
      if (role === "umkm") document.getElementById("umkmBtn").style.display = "inline-block";
      if (role === "investor") document.getElementById("investorBtn").style.display = "inline-block";

      // Fetch UMKM data
      try {
        const res = await fetch("/api/umkmusers");
        const umkmList = await res.json();
        const container = document.getElementById("umkmContainer");

        if (umkmList.length === 0) {
          container.innerHTML = `<p class="loading">No UMKM data available yet.</p>`;
          return;
        }

        container.innerHTML = umkmList.map(umkm => `
          <div class="umkm-card">
            <h3>${umkm.business_name || 'Unnamed Business'}</h3>
            <p><strong>Owner:</strong> ${umkm.owner || 'N/A'}</p>
            <p><strong>Category:</strong> ${umkm.category || 'N/A'}</p>
            <p><strong>Location:</strong> ${umkm.location || 'N/A'}</p>
            <p class="revenue">Revenue: ${umkm.revenue ? `$${umkm.revenue.toLocaleString()}` : 'N/A'}</p>
            <p><strong>Description:</strong><br>${umkm.business_desc || 'No description provided.'}</p>
          </div>
        `).join("");
      } catch (err) {
        document.getElementById("umkmContainer").innerHTML = 
          `<p class="loading">Failed to load data. Please try again later.</p>`;
        console.error(err);
      }
    };

    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "/login.html";
    });

    document.getElementById("adminBtn").addEventListener("click", () => {
      window.location.href = "/admin.html";
    });

    document.getElementById("umkmBtn").addEventListener("click", () => {
      window.location.href = "add-umkm.html";
    });

    document.getElementById("investorBtn").addEventListener("click", () => {
      window.location.href = "add-investor.html";
    });
  </script>
</body>
</html>
