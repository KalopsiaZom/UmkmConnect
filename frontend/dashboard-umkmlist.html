<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UMKM Dashboard</title>
  <link rel="stylesheet" href="dashboard-umkmlist.css">
</head>
<body>
  <div class="sidebar">
    <h2>UMKM Connect</h2>
    <a href="dashboard.html">Dashboard</a>
    <a href="dashboard-userprofile.html">User Profile</a>
    <a href="#" class="active">UMKM List</a>
  </div>

  <div class="main-content">
    <div class="header">
      <h1>UMKM Directory</h1>
      <div class="buttons">
        <button id="adminBtn" style="display:none;">Admin Panel</button>
        <button id="umkmBtn" style="display:none;">Add UMKM</button>
        <button id="investorBtn" style="display:none;">Invest</button>
        <button id="logoutBtn">Logout</button>
      </div>
    </div>

    <p id="welcome" style="padding: 0 25px;"></p>

    <div id="umkmContainer" class="umkm-grid">
      <p class="loading">Loading UMKM data...</p>
    </div>
  </div>

  <script>
    window.onload = async () => {
      const role = localStorage.getItem("role");
      const username = localStorage.getItem("username");

      if (!role) {
        alert("Please log in first!");
        window.location.href = "/login.html";
        return;
      }

      document.getElementById("welcome").textContent = 
        `Welcome, ${username}! You are logged in as ${role}.`;

      if (role === "admin") document.getElementById("adminBtn").style.display = "inline-block";
      if (role === "umkm") document.getElementById("umkmBtn").style.display = "inline-block";
      if (role === "investor") document.getElementById("investorBtn").style.display = "inline-block";

      // Fetch UMKM data
      try {
        const res = await fetch("/api/umkmusers");
        const umkmList = await res.json();
        const container = document.getElementById("umkmContainer");

        if (umkmList.length === 0) {
          container.innerHTML = `<p class="loading">No UMKM data available yet.</p>`;
          return;
        }

        container.innerHTML = umkmList.map(umkm => `
          <div class="umkm-card">
            <h3>${umkm.business_name || 'Unnamed Business'}</h3>
            <p><strong>Owner:</strong> ${umkm.owner || 'N/A'}</p>
            <p><strong>Category:</strong> ${umkm.category || 'N/A'}</p>
            <p><strong>Location:</strong> ${umkm.location || 'N/A'}</p>
            <p class="revenue">Revenue: ${umkm.revenue ? `$${umkm.revenue.toLocaleString()}` : 'N/A'}</p>
            <p><strong>Description:</strong><br>${umkm.business_desc || 'No description provided.'}</p>
          </div>
        `).join("");
      } catch (err) {
        document.getElementById("umkmContainer").innerHTML = 
          `<p class="loading">Failed to load data. Please try again later.</p>`;
        console.error(err);
      }
    };

    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "/login.html";
    });

    document.getElementById("adminBtn").addEventListener("click", () => {
      window.location.href = "/admin.html";
    });

    document.getElementById("umkmBtn").addEventListener("click", () => {
      window.location.href = "add-umkm.html";
    });

    document.getElementById("investorBtn").addEventListener("click", () => {
      window.location.href = "add-investor.html";
    });
  </script>
</body>
</html>
